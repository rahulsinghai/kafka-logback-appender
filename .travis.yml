# Faster builds https://blog.travis-ci.com/2014-12-17-faster-builds-with-container-based-infrastructure
sudo: false
dist: trusty

language: java

jdk:
  - openjdk8

before_install:
  - echo "Download Maven ${CUSTOM_MVN_VERION}....";
  - wget https://archive.apache.org/dist/maven/maven-3/${CUSTOM_MVN_VERION}/binaries/apache-maven-${CUSTOM_MVN_VERION}-bin.tar.gz
  - tar xzvf apache-maven-${CUSTOM_MVN_VERION}-bin.tar.gz
  - export M2_HOME=`pwd`/apache-maven-${CUSTOM_MVN_VERION}
  - export PATH=$M2_HOME/bin:$PATH
  - mvn -v

install: mvn install -DskipTests=true -Dgpg.skip=true;

# Run unit and integration tests
script: mvn verify -B -q

# cache the build tool's caches
cache:
  directories:
    - "$HOME/.m2"

# After the build, run the script that will collect JaCoCo statistics
# It uses the third-party service https://codecov.io/
after_success:
  - bash <(curl -s https://codecov.io/bash)
#  - [ [ $TRAVIS_BRANCH == "master" && $TRAVIS_REPO_SLUG == "rahulsinghai/kafka-logback-appender"
#    && $TRAVIS_PULL_REQUEST == "false" ] ] && { curl https://raw.githubusercontent.com/holisticon/travis-configuration/master/settings.xml --location
#    --create-dirs -o target/travis/settings.xml; } && { mvn cobertura:cobertura coveralls:report deploy -q --settings target/travis/settings.xml
#    -Dgpg.skip=true; }
#  - if [ "$TRAVIS_BRANCH" != "master" ]; then openssl aes-256-cbc -pass pass:$ENC_PASSWORD
#    -in .travis/sign.asc.enc -out .travis/sign.asc -d; gpg -q --fast-import .travis/sign.asc;
#    mvn deploy --settings .travis.settings.xml -DskipTests=true; chmod +x .travis/upload-build.sh; .travis/upload-build.sh; fi

# Send a notification to your email id, if the assembly has dropped
notifications:
  email:
    recipients:
      - singrahu@gmail.com
    on_success: change  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: never     # options: [always|never|change] default: always
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/3030952ce142f06ee5b3
    on_success: change  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: never     # options: [always|never|change] default: always

env:
  global:
    - CUSTOM_MVN_VERION="3.6.1"
